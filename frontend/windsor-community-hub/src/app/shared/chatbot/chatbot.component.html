<!-- Floating Chat Button (when closed) -->
<button *ngIf="!isOpen()" class="chat-button" (click)="toggleChat()" aria-label="Open chat">
  <span class="chat-icon">ğŸ’¬</span>
  <span class="chat-pulse"></span>
</button>

<!-- Chat Window (when open) -->
<div *ngIf="isOpen()" class="chat-window">
  <!-- Header -->
  <div class="chat-header">
    <div class="header-content">
      <span class="bot-avatar">ğŸ¤–</span>
      <div class="bot-info">
        <h3>Windsor Assistant</h3>
        <span class="status">Online</span>
      </div>
    </div>
    <button class="btn-close" (click)="toggleChat()" aria-label="Close chat">âœ•</button>
  </div>

  <!-- Messages -->
  <div class="chat-messages" #messagesContainer>
    <div *ngFor="let message of messages()" class="message" [class.user-message]="message.sender === 'user'" [class.bot-message]="message.sender === 'bot'">
      <div class="message-avatar" *ngIf="message.sender === 'bot'">ğŸ¤–</div>
      <div class="message-content">
        <div class="message-bubble">
          <p [innerHTML]="message.text | formatChatMessage"></p>
        </div>
        <span class="message-time">{{ message.timestamp | date: 'shortTime' }}</span>
      </div>
      <div class="message-avatar user-avatar" *ngIf="message.sender === 'user'">ğŸ‘¤</div>
    </div>

    <!-- Typing Indicator -->
    <div *ngIf="isTyping()" class="message bot-message typing-indicator">
      <div class="message-avatar">ğŸ¤–</div>
      <div class="message-content">
        <div class="message-bubble">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="chat-input">
    <button class="btn-clear" (click)="clearChat()" title="Clear chat" aria-label="Clear chat">
      ğŸ—‘ï¸
    </button>
    <input
      type="text"
      [(ngModel)]="userInput"
      (keypress)="handleKeyPress($event)"
      placeholder="Ask about housing or events..."
      [disabled]="isTyping()"
      class="input-field"
    />
    <button
      class="btn-send"
      (click)="sendMessage()"
      [disabled]="!userInput().trim() || isTyping()"
      aria-label="Send message"
    >
      <span class="send-icon">ğŸ“¤</span>
    </button>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <button class="quick-action-btn" (click)="userInput.set('What rooms are available?'); sendMessage()">
      ğŸ  Available Rooms
    </button>
    <button class="quick-action-btn" (click)="userInput.set('Show me events'); sendMessage()">
      ğŸ“… Events
    </button>
    <button class="quick-action-btn" (click)="userInput.set('Rooms under $700'); sendMessage()">
      ğŸ’° Budget Options
    </button>
  </div>
</div>

