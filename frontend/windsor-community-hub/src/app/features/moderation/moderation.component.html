<div class="moderation-container">
  <header class="page-header">
    <div>
      <h1>Listing Moderation</h1>
      <p>Review and verify housing listings to help keep the community safe.</p>
    </div>
    <button type="button" class="btn-refresh" (click)="loadListings()" [disabled]="isLoading()">
      Refresh
    </button>
  </header>

  <div class="alert alert-error" *ngIf="errorMessage() as error">
    {{ error }}
  </div>

  <div class="alert alert-success" *ngIf="successMessage() as message">
    {{ message }}
  </div>

  <div *ngIf="currentUser$ | async as currentUser; else signInPrompt">
    <div *ngIf="currentUser.role === 'student'" class="alert alert-warning">
      You need helper privileges to moderate listings.
    </div>

    <div *ngIf="currentUser.role !== 'student'">
      <!-- Unverified Listings Section -->
      <section class="listings-section">
        <h2 class="section-title">
          Pending Verification
          <span class="count-badge">{{ unverifiedListings.length }}</span>
        </h2>

        <div *ngIf="unverifiedListings.length === 0" class="empty-state">
          <p>All listings are verified! Great job!</p>
        </div>

        <div class="listings-grid">
          <article *ngFor="let listing of unverifiedListings" class="listing-card unverified">
            <div class="listing-photo" *ngIf="listing.photos && listing.photos.length > 0">
              <img [src]="listing.photos[0]" [alt]="listing.title" />
            </div>
            <div class="listing-photo-placeholder" *ngIf="!listing.photos || listing.photos.length === 0">
              <span>ðŸ“·</span>
            </div>

            <div class="listing-content">
              <div class="listing-header">
                <h3>{{ listing.title }}</h3>
                <span class="price">${{ listing.price | number: '1.0-0' }}/mo</span>
              </div>

              <p class="location">{{ listing.location }}</p>
              <p class="description">{{ listing.description }}</p>

              <div class="listing-meta">
                <span class="owner">{{ listing.owner.full_name }}</span>
                <span class="date">{{ listing.created_at | date: 'short' }}</span>
              </div>

              <div class="contact">
                Contact: <a [href]="'mailto:' + listing.contact">{{ listing.contact }}</a>
              </div>

              <button
                type="button"
                class="btn-verify"
                (click)="verifyListing(listing)"
                [disabled]="isLoading()"
              >
                Verify Listing
              </button>
            </div>
          </article>
        </div>
      </section>

      <!-- Verified Listings Section -->
      <section class="listings-section">
        <h2 class="section-title">
          Verified Listings
          <span class="count-badge verified">{{ verifiedListings.length }}</span>
        </h2>

        <div class="listings-grid">
          <article *ngFor="let listing of verifiedListings" class="listing-card verified">
            <div class="listing-photo" *ngIf="listing.photos && listing.photos.length > 0">
              <img [src]="listing.photos[0]" [alt]="listing.title" />
            </div>
            <div class="listing-photo-placeholder" *ngIf="!listing.photos || listing.photos.length === 0">
              <span>ðŸ“·</span>
            </div>

            <div class="listing-content">
              <div class="listing-header">
                <h3>{{ listing.title }}</h3>
                <span class="price">${{ listing.price | number: '1.0-0' }}/mo</span>
              </div>

              <span class="verified-badge">Verified</span>

              <p class="location">{{ listing.location }}</p>
              <p class="description">{{ listing.description }}</p>

              <div class="listing-meta">
                <span class="owner">{{ listing.owner.full_name }}</span>
                <span class="date">{{ listing.created_at | date: 'short' }}</span>
              </div>
            </div>
          </article>
        </div>
      </section>
    </div>
  </div>

  <ng-template #signInPrompt>
    <div class="sign-in-prompt">
      <p>Please sign in with a helper account to access moderation tools.</p>
    </div>
  </ng-template>
</div>

